# Flatpak .NET Generator

Tool to automatically generate a `flatpak-builder` sources file from a .NET Core .csproj file.

## Requirements

You need to have `org.freedesktop.Sdk` and `org.freedesktop.Sdk.Extension.dotnet` installed.
both branch 22.08 (21.08 is selectable by passing it in via the `--dotnet` or `-d` arguments)

## Usage

Run `flatpak-dotnet-generator.py my-output-sources.json my.input.Desktop.csproj`. 

Then, you can use the sources file like this:

```yaml
modules:
  - name: my-module
    buildsystem: simple
    build-commands:
      - '. /usr/lib/sdk/dotnet/enable.sh; dotnet build -f netcoreapp2.1 -c Release --source nuget-sources my.input.Desktop.csproj'
    sources:
      - my-output-sources.json
```

When using `dotnet build` or `dotnet publish` make sure you add the `--source nuget-sources` argument in order for `dotnet`  
to pick up the source files generated by this tool.  

If you want to change the directory name, run `flatpak-dotnet-generator.py` with `--destdir=my-destdir`.

## Arguments
- `--runtime` or `-r` The target [runtime](https://learn.microsoft.com/en-us/dotnet/core/rid-catalog#linux-rids) to restore packages for.
- `--dotnet` or `-d` The target version of dotnet to use. (Defaults to latest LTS version)
- `--freedesktop` or `-f` The target version of the freedesktop sdk to use. (Defaults to latest version)
- `--destdir` The directory the generated sources file will save sources to `nuget-sources` by default.
- `--dotnet-args` or `-a` Pass additional arguments to the `dotnet` command.

## Example

To pass multiple arguments to the `dotnet` command, use the `--dotnet-args` option:

```bash
python3 flatpak-dotnet-generator.py my-output-sources.json my.input.Desktop.csproj --runtime linux-x64 --dotnet-args --no-cache --verbosity detailed
```

In this example:
- `--no-cache` and `--verbosity detailed` are additional arguments passed to the `dotnet` command.
- You can add as many arguments as needed after `--dotnet-args`.

## Development

1. Install Poetry v2 https://python-poetry.org/docs/#installation
2. `poetry install --with dev`
3. Format and lint: `poetry run ruff format && poetry run ruff check --fix --exit-non-zero-on-fix`
4. Type check: `poetry run mypy .`
